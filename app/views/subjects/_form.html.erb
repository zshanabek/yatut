<script src="//maps.google.com/maps/api/js?key=AIzaSyBj_0GBAd1mmKjDg9M2wHE4YoFF9J2-1hA"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<%= form_with(model: subject, local: true) do |form| %>
  <% if subject.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(subject.errors.count, "error") %> prohibited this subject from being saved:</h2>

      <ul>
      <% subject.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label 'Название' %>
    <%= form.text_field :name, class: "form-control"%>
  </div>

  <div class="field">
    <%= form.label 'Широта' %>
    <%= form.number_field :latitude , step: :any, class: "form-control"%>
  </div>

  <div class="field">
    <%= form.label 'Долгота' %>
    <%= form.number_field :longitude, step: :any, class: "form-control" %>
  </div>
  
  <div class="field">
    <%= form.label 'Радиус' %>
    <%= form.number_field :radius, class: "form-control" %>
  </div>
  
  <div class="field">
    <%= form.label 'Начинается в' %>
    <%= form.time_select :starts_at, :value => subject.starts_at, :default => Time.now %>
  </div>
  <div class="field">
    <%= form.label 'Заканчивается в' %>
    <%= form.time_select :ends_at, :value => subject.ends_at, :default => Time.now %>
   </div>
        
  <div class="field">
    <%= form.label 'Дата начала' %>
    <%= form.datetime_select :start_time, class: "form-control" %>
  </div>

  <!-- <div class="field">
    <%= form.label 'Повторяющаяся' %>
    <%= form.select_recurring :recurring, nil, allow_blank: true %>
  </div> -->

  <div style='width: 800px;'>
    <div id="map" style='width: 800px; height: 400px;'></div>
  </div>
  
  

  <div class="actions">
    <%= form.submit 'Создать предмет', class:"btn btn-primary"  %>
  </div>

<% end %>


<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    var myLatlng = {lat: 43.238255, lng: 76.946682};
    
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 10,
      center: myLatlng
    });
    map.addListener('click', function(e) {
      placeMarkerAndPanTo(e.latLng, map);
    });

    function placeMarkerAndPanTo(latLng, map) {
      var marker = new google.maps.Marker({
        position: latLng,
        map: map
      }); 
      map.panTo(latLng);
    }
  });
</script>